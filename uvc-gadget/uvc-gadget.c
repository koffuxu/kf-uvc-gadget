<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!-- git web interface version 2.1.4, (C) 2005-2006, Kay Sievers <kay.sievers@vrfy.org>, Christian Gierke -->
<!-- git core binaries version 2.1.4 -->
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<meta name="generator" content="gitweb/2.1.4 git/2.1.4"/>
<meta name="robots" content="index, nofollow"/>
<title>git.ideasonboard.org Git - uvc-gadget.git/blob - uvc-gadget.c</title>
<base href="http://git.ideasonboard.org" />
<link rel="stylesheet" type="text/css" href="/static/gitweb.css"/>
<link rel="alternate" title="uvc-gadget.git - history of uvc-gadget.c - RSS feed" href="/uvc-gadget.git/rss?f=uvc-gadget.c" type="application/rss+xml" />
<link rel="alternate" title="uvc-gadget.git - history of uvc-gadget.c - RSS feed (no merges)" href="/uvc-gadget.git/rss?f=uvc-gadget.c;opt=--no-merges" type="application/rss+xml" />
<link rel="alternate" title="uvc-gadget.git - history of uvc-gadget.c - Atom feed" href="/uvc-gadget.git/atom?f=uvc-gadget.c" type="application/atom+xml" />
<link rel="alternate" title="uvc-gadget.git - history of uvc-gadget.c - Atom feed (no merges)" href="/uvc-gadget.git/atom?f=uvc-gadget.c;opt=--no-merges" type="application/atom+xml" />
<link rel="shortcut icon" href="/static/git-favicon.png" type="image/png" />
</head>
<body>
<div class="page_header">
<a href="http://git-scm.com/" title="git homepage"><img src="/static/git-logo.png" class="logo" alt="git" height="27" width="72" /></a><a href="/">projects</a> / <a href="/uvc-gadget.git">uvc-gadget.git</a> / blob
</div>
<div class="page_nav">
<a href="/uvc-gadget.git">summary</a> | <a href="/uvc-gadget.git/shortlog">shortlog</a> | <a href="/uvc-gadget.git/log">log</a> | <a href="/uvc-gadget.git/commit/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13">commit</a> | <a href="/uvc-gadget.git/commitdiff/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13">commitdiff</a> | <a href="/uvc-gadget.git/tree/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13">tree</a><br/>
<a href="/uvc-gadget.git/history/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c">history</a> | <a href="/uvc-gadget.git/blob_plain/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c">raw</a> | <a href="/uvc-gadget.git/blob/HEAD:/uvc-gadget.c">HEAD</a><br/>
</div>
<div class="header">
<a class="title" href="/uvc-gadget.git/commit/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13">uvc-gadget: Do not send Set Interface (alternate setting) response twice</a>
</div>
<div class="page_path"><a title="tree root" href="/uvc-gadget.git/tree/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13">[uvc-gadget.git]</a> / <a href="/uvc-gadget.git/blob_plain/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c" title="uvc-gadget.c">uvc-gadget.c</a><br/></div>
<div class="page_body">
<div class="pre"><a id="l1" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l1" class="linenr">   1</a> /*</div>
<div class="pre"><a id="l2" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l2" class="linenr">   2</a> &nbsp;*&nbsp;UVC&nbsp;gadget&nbsp;test&nbsp;application</div>
<div class="pre"><a id="l3" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l3" class="linenr">   3</a> &nbsp;*</div>
<div class="pre"><a id="l4" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l4" class="linenr">   4</a> &nbsp;*&nbsp;Copyright&nbsp;(C)&nbsp;2010&nbsp;Ideas&nbsp;on&nbsp;board&nbsp;SPRL&nbsp;&lt;laurent.pinchart@ideasonboard.com&gt;</div>
<div class="pre"><a id="l5" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l5" class="linenr">   5</a> &nbsp;*</div>
<div class="pre"><a id="l6" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l6" class="linenr">   6</a> &nbsp;*&nbsp;This&nbsp;program&nbsp;is&nbsp;free&nbsp;software;&nbsp;you&nbsp;can&nbsp;redistribute&nbsp;it&nbsp;and/or&nbsp;modify</div>
<div class="pre"><a id="l7" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l7" class="linenr">   7</a> &nbsp;*&nbsp;it&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;as&nbsp;published&nbsp;by</div>
<div class="pre"><a id="l8" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l8" class="linenr">   8</a> &nbsp;*&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation;&nbsp;either&nbsp;version&nbsp;2&nbsp;of&nbsp;the&nbsp;License,&nbsp;or</div>
<div class="pre"><a id="l9" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l9" class="linenr">   9</a> &nbsp;*&nbsp;(at&nbsp;your&nbsp;option)&nbsp;any&nbsp;later&nbsp;version.</div>
<div class="pre"><a id="l10" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l10" class="linenr">  10</a> &nbsp;*</div>
<div class="pre"><a id="l11" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l11" class="linenr">  11</a> &nbsp;*&nbsp;This&nbsp;program&nbsp;is&nbsp;distributed&nbsp;in&nbsp;the&nbsp;hope&nbsp;that&nbsp;it&nbsp;will&nbsp;be&nbsp;useful,</div>
<div class="pre"><a id="l12" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l12" class="linenr">  12</a> &nbsp;*&nbsp;but&nbsp;WITHOUT&nbsp;ANY&nbsp;WARRANTY;&nbsp;without&nbsp;even&nbsp;the&nbsp;implied&nbsp;warranty&nbsp;of</div>
<div class="pre"><a id="l13" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l13" class="linenr">  13</a> &nbsp;*&nbsp;MERCHANTABILITY&nbsp;or&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE.&nbsp;&nbsp;See&nbsp;the</div>
<div class="pre"><a id="l14" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l14" class="linenr">  14</a> &nbsp;*&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;for&nbsp;more&nbsp;details.</div>
<div class="pre"><a id="l15" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l15" class="linenr">  15</a> &nbsp;*</div>
<div class="pre"><a id="l16" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l16" class="linenr">  16</a> &nbsp;*&nbsp;You&nbsp;should&nbsp;have&nbsp;received&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;along</div>
<div class="pre"><a id="l17" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l17" class="linenr">  17</a> &nbsp;*&nbsp;with&nbsp;this&nbsp;program;&nbsp;if&nbsp;not,&nbsp;write&nbsp;to&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation,&nbsp;Inc.,</div>
<div class="pre"><a id="l18" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l18" class="linenr">  18</a> &nbsp;*/</div>
<div class="pre"><a id="l19" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l19" class="linenr">  19</a> </div>
<div class="pre"><a id="l20" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l20" class="linenr">  20</a> #include&nbsp;&lt;sys/time.h&gt;</div>
<div class="pre"><a id="l21" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l21" class="linenr">  21</a> #include&nbsp;&lt;sys/ioctl.h&gt;</div>
<div class="pre"><a id="l22" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l22" class="linenr">  22</a> #include&nbsp;&lt;sys/mman.h&gt;</div>
<div class="pre"><a id="l23" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l23" class="linenr">  23</a> #include&nbsp;&lt;sys/types.h&gt;</div>
<div class="pre"><a id="l24" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l24" class="linenr">  24</a> #include&nbsp;&lt;sys/stat.h&gt;</div>
<div class="pre"><a id="l25" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l25" class="linenr">  25</a> #include&nbsp;&lt;sys/select.h&gt;</div>
<div class="pre"><a id="l26" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l26" class="linenr">  26</a> </div>
<div class="pre"><a id="l27" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l27" class="linenr">  27</a> #include&nbsp;&lt;unistd.h&gt;</div>
<div class="pre"><a id="l28" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l28" class="linenr">  28</a> #include&nbsp;&lt;fcntl.h&gt;</div>
<div class="pre"><a id="l29" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l29" class="linenr">  29</a> #include&nbsp;&lt;stdlib.h&gt;</div>
<div class="pre"><a id="l30" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l30" class="linenr">  30</a> #include&nbsp;&lt;stdio.h&gt;</div>
<div class="pre"><a id="l31" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l31" class="linenr">  31</a> #include&nbsp;&lt;stdint.h&gt;</div>
<div class="pre"><a id="l32" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l32" class="linenr">  32</a> #include&nbsp;&lt;string.h&gt;</div>
<div class="pre"><a id="l33" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l33" class="linenr">  33</a> #include&nbsp;&lt;errno.h&gt;</div>
<div class="pre"><a id="l34" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l34" class="linenr">  34</a> </div>
<div class="pre"><a id="l35" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l35" class="linenr">  35</a> #include&nbsp;&lt;linux/usb/ch9.h&gt;</div>
<div class="pre"><a id="l36" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l36" class="linenr">  36</a> #include&nbsp;&lt;linux/usb/video.h&gt;</div>
<div class="pre"><a id="l37" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l37" class="linenr">  37</a> #include&nbsp;&lt;linux/videodev2.h&gt;</div>
<div class="pre"><a id="l38" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l38" class="linenr">  38</a> </div>
<div class="pre"><a id="l39" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l39" class="linenr">  39</a> #include&nbsp;&quot;../drivers/usb/gadget/uvc.h&quot;</div>
<div class="pre"><a id="l40" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l40" class="linenr">  40</a> </div>
<div class="pre"><a id="l41" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l41" class="linenr">  41</a> #define&nbsp;clamp(val,&nbsp;min,&nbsp;max)&nbsp;({&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</div>
<div class="pre"><a id="l42" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l42" class="linenr">  42</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;typeof(val)&nbsp;__val&nbsp;=&nbsp;(val);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</div>
<div class="pre"><a id="l43" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l43" class="linenr">  43</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;typeof(min)&nbsp;__min&nbsp;=&nbsp;(min);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</div>
<div class="pre"><a id="l44" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l44" class="linenr">  44</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;typeof(max)&nbsp;__max&nbsp;=&nbsp;(max);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</div>
<div class="pre"><a id="l45" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l45" class="linenr">  45</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)&nbsp;(&amp;__val&nbsp;==&nbsp;&amp;__min);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</div>
<div class="pre"><a id="l46" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l46" class="linenr">  46</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)&nbsp;(&amp;__val&nbsp;==&nbsp;&amp;__max);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\</div>
<div class="pre"><a id="l47" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l47" class="linenr">  47</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__val&nbsp;=&nbsp;__val&nbsp;&lt;&nbsp;__min&nbsp;?&nbsp;__min:&nbsp;__val;&nbsp;&nbsp;&nbsp;\</div>
<div class="pre"><a id="l48" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l48" class="linenr">  48</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__val&nbsp;&gt;&nbsp;__max&nbsp;?&nbsp;__max:&nbsp;__val;&nbsp;})</div>
<div class="pre"><a id="l49" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l49" class="linenr">  49</a> </div>
<div class="pre"><a id="l50" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l50" class="linenr">  50</a> #define&nbsp;ARRAY_SIZE(a)&nbsp;&nbsp;&nbsp;((sizeof(a)&nbsp;/&nbsp;sizeof(a[0])))</div>
<div class="pre"><a id="l51" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l51" class="linenr">  51</a> </div>
<div class="pre"><a id="l52" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l52" class="linenr">  52</a> struct&nbsp;uvc_device</div>
<div class="pre"><a id="l53" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l53" class="linenr">  53</a> {</div>
<div class="pre"><a id="l54" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l54" class="linenr">  54</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;fd;</div>
<div class="pre"><a id="l55" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l55" class="linenr">  55</a> </div>
<div class="pre"><a id="l56" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l56" class="linenr">  56</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_streaming_control&nbsp;probe;</div>
<div class="pre"><a id="l57" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l57" class="linenr">  57</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_streaming_control&nbsp;commit;</div>
<div class="pre"><a id="l58" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l58" class="linenr">  58</a> </div>
<div class="pre"><a id="l59" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l59" class="linenr">  59</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;control;</div>
<div class="pre"><a id="l60" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l60" class="linenr">  60</a> </div>
<div class="pre"><a id="l61" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l61" class="linenr">  61</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;fcc;</div>
<div class="pre"><a id="l62" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l62" class="linenr">  62</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;width;</div>
<div class="pre"><a id="l63" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l63" class="linenr">  63</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;height;</div>
<div class="pre"><a id="l64" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l64" class="linenr">  64</a> </div>
<div class="pre"><a id="l65" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l65" class="linenr">  65</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;**mem;</div>
<div class="pre"><a id="l66" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l66" class="linenr">  66</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;nbufs;</div>
<div class="pre"><a id="l67" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l67" class="linenr">  67</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;bufsize;</div>
<div class="pre"><a id="l68" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l68" class="linenr">  68</a> </div>
<div class="pre"><a id="l69" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l69" class="linenr">  69</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;bulk;</div>
<div class="pre"><a id="l70" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l70" class="linenr">  70</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;color;</div>
<div class="pre"><a id="l71" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l71" class="linenr">  71</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;imgsize;</div>
<div class="pre"><a id="l72" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l72" class="linenr">  72</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;*imgdata;</div>
<div class="pre"><a id="l73" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l73" class="linenr">  73</a> };</div>
<div class="pre"><a id="l74" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l74" class="linenr">  74</a> </div>
<div class="pre"><a id="l75" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l75" class="linenr">  75</a> static&nbsp;struct&nbsp;uvc_device&nbsp;*</div>
<div class="pre"><a id="l76" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l76" class="linenr">  76</a> uvc_open(const&nbsp;char&nbsp;*devname)</div>
<div class="pre"><a id="l77" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l77" class="linenr">  77</a> {</div>
<div class="pre"><a id="l78" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l78" class="linenr">  78</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_device&nbsp;*dev;</div>
<div class="pre"><a id="l79" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l79" class="linenr">  79</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_capability&nbsp;cap;</div>
<div class="pre"><a id="l80" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l80" class="linenr">  80</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;ret;</div>
<div class="pre"><a id="l81" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l81" class="linenr">  81</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;fd;</div>
<div class="pre"><a id="l82" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l82" class="linenr">  82</a> </div>
<div class="pre"><a id="l83" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l83" class="linenr">  83</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fd&nbsp;=&nbsp;open(devname,&nbsp;O_RDWR&nbsp;|&nbsp;O_NONBLOCK);</div>
<div class="pre"><a id="l84" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l84" class="linenr">  84</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fd&nbsp;==&nbsp;-1)&nbsp;{</div>
<div class="pre"><a id="l85" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l85" class="linenr">  85</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;v4l2&nbsp;open&nbsp;failed:&nbsp;%s&nbsp;(%d)\n&quot;,&nbsp;strerror(errno),&nbsp;errno);</div>
<div class="pre"><a id="l86" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l86" class="linenr">  86</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</div>
<div class="pre"><a id="l87" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l87" class="linenr">  87</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l88" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l88" class="linenr">  88</a> </div>
<div class="pre"><a id="l89" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l89" class="linenr">  89</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;open&nbsp;succeeded,&nbsp;file&nbsp;descriptor&nbsp;=&nbsp;%d\n&quot;,&nbsp;fd);</div>
<div class="pre"><a id="l90" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l90" class="linenr">  90</a> </div>
<div class="pre"><a id="l91" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l91" class="linenr">  91</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;ioctl(fd,&nbsp;VIDIOC_QUERYCAP,&nbsp;&amp;cap);</div>
<div class="pre"><a id="l92" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l92" class="linenr">  92</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ret&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l93" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l93" class="linenr">  93</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;unable&nbsp;to&nbsp;query&nbsp;device:&nbsp;%s&nbsp;(%d)\n&quot;,&nbsp;strerror(errno),</div>
<div class="pre"><a id="l94" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l94" class="linenr">  94</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errno);</div>
<div class="pre"><a id="l95" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l95" class="linenr">  95</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(fd);</div>
<div class="pre"><a id="l96" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l96" class="linenr">  96</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</div>
<div class="pre"><a id="l97" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l97" class="linenr">  97</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l98" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l98" class="linenr">  98</a> </div>
<div class="pre"><a id="l99" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l99" class="linenr">  99</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;device&nbsp;is&nbsp;%s&nbsp;on&nbsp;bus&nbsp;%s\n&quot;,&nbsp;cap.card,&nbsp;cap.bus_info);</div>
<div class="pre"><a id="l100" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l100" class="linenr"> 100</a> </div>
<div class="pre"><a id="l101" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l101" class="linenr"> 101</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev&nbsp;=&nbsp;malloc(sizeof&nbsp;*dev);</div>
<div class="pre"><a id="l102" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l102" class="linenr"> 102</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev&nbsp;==&nbsp;NULL)&nbsp;{</div>
<div class="pre"><a id="l103" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l103" class="linenr"> 103</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(fd);</div>
<div class="pre"><a id="l104" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l104" class="linenr"> 104</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;NULL;</div>
<div class="pre"><a id="l105" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l105" class="linenr"> 105</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l106" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l106" class="linenr"> 106</a> </div>
<div class="pre"><a id="l107" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l107" class="linenr"> 107</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(dev,&nbsp;0,&nbsp;sizeof&nbsp;*dev);</div>
<div class="pre"><a id="l108" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l108" class="linenr"> 108</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;fd&nbsp;=&nbsp;fd;</div>
<div class="pre"><a id="l109" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l109" class="linenr"> 109</a> </div>
<div class="pre"><a id="l110" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l110" class="linenr"> 110</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;dev;</div>
<div class="pre"><a id="l111" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l111" class="linenr"> 111</a> }</div>
<div class="pre"><a id="l112" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l112" class="linenr"> 112</a> </div>
<div class="pre"><a id="l113" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l113" class="linenr"> 113</a> static&nbsp;void</div>
<div class="pre"><a id="l114" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l114" class="linenr"> 114</a> uvc_close(struct&nbsp;uvc_device&nbsp;*dev)</div>
<div class="pre"><a id="l115" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l115" class="linenr"> 115</a> {</div>
<div class="pre"><a id="l116" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l116" class="linenr"> 116</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(dev-&gt;fd);</div>
<div class="pre"><a id="l117" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l117" class="linenr"> 117</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(dev-&gt;imgdata);</div>
<div class="pre"><a id="l118" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l118" class="linenr"> 118</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(dev-&gt;mem);</div>
<div class="pre"><a id="l119" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l119" class="linenr"> 119</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(dev);</div>
<div class="pre"><a id="l120" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l120" class="linenr"> 120</a> }</div>
<div class="pre"><a id="l121" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l121" class="linenr"> 121</a> </div>
<div class="pre"><a id="l122" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l122" class="linenr"> 122</a> /*&nbsp;---------------------------------------------------------------------------</div>
<div class="pre"><a id="l123" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l123" class="linenr"> 123</a> &nbsp;*&nbsp;Video&nbsp;streaming</div>
<div class="pre"><a id="l124" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l124" class="linenr"> 124</a> &nbsp;*/</div>
<div class="pre"><a id="l125" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l125" class="linenr"> 125</a> </div>
<div class="pre"><a id="l126" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l126" class="linenr"> 126</a> static&nbsp;void</div>
<div class="pre"><a id="l127" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l127" class="linenr"> 127</a> uvc_video_fill_buffer(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;struct&nbsp;v4l2_buffer&nbsp;*buf)</div>
<div class="pre"><a id="l128" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l128" class="linenr"> 128</a> {</div>
<div class="pre"><a id="l129" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l129" class="linenr"> 129</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;bpl;</div>
<div class="pre"><a id="l130" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l130" class="linenr"> 130</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;i;</div>
<div class="pre"><a id="l131" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l131" class="linenr"> 131</a> </div>
<div class="pre"><a id="l132" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l132" class="linenr"> 132</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(dev-&gt;fcc)&nbsp;{</div>
<div class="pre"><a id="l133" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l133" class="linenr"> 133</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;V4L2_PIX_FMT_YUYV:</div>
<div class="pre"><a id="l134" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l134" class="linenr"> 134</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Fill&nbsp;the&nbsp;buffer&nbsp;with&nbsp;video&nbsp;data.&nbsp;*/</div>
<div class="pre"><a id="l135" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l135" class="linenr"> 135</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bpl&nbsp;=&nbsp;dev-&gt;width&nbsp;*&nbsp;2;</div>
<div class="pre"><a id="l136" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l136" class="linenr"> 136</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;dev-&gt;height;&nbsp;++i)</div>
<div class="pre"><a id="l137" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l137" class="linenr"> 137</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(dev-&gt;mem[buf-&gt;index]&nbsp;+&nbsp;i*bpl,&nbsp;dev-&gt;color++,&nbsp;bpl);</div>
<div class="pre"><a id="l138" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l138" class="linenr"> 138</a> </div>
<div class="pre"><a id="l139" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l139" class="linenr"> 139</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf-&gt;bytesused&nbsp;=&nbsp;bpl&nbsp;*&nbsp;dev-&gt;height;</div>
<div class="pre"><a id="l140" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l140" class="linenr"> 140</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l141" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l141" class="linenr"> 141</a> </div>
<div class="pre"><a id="l142" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l142" class="linenr"> 142</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;V4L2_PIX_FMT_MJPEG:</div>
<div class="pre"><a id="l143" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l143" class="linenr"> 143</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(dev-&gt;mem[buf-&gt;index],&nbsp;dev-&gt;imgdata,&nbsp;dev-&gt;imgsize);</div>
<div class="pre"><a id="l144" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l144" class="linenr"> 144</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf-&gt;bytesused&nbsp;=&nbsp;dev-&gt;imgsize;</div>
<div class="pre"><a id="l145" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l145" class="linenr"> 145</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l146" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l146" class="linenr"> 146</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l147" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l147" class="linenr"> 147</a> }</div>
<div class="pre"><a id="l148" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l148" class="linenr"> 148</a> </div>
<div class="pre"><a id="l149" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l149" class="linenr"> 149</a> static&nbsp;int</div>
<div class="pre"><a id="l150" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l150" class="linenr"> 150</a> uvc_video_process(struct&nbsp;uvc_device&nbsp;*dev)</div>
<div class="pre"><a id="l151" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l151" class="linenr"> 151</a> {</div>
<div class="pre"><a id="l152" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l152" class="linenr"> 152</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_buffer&nbsp;buf;</div>
<div class="pre"><a id="l153" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l153" class="linenr"> 153</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;ret;</div>
<div class="pre"><a id="l154" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l154" class="linenr"> 154</a> </div>
<div class="pre"><a id="l155" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l155" class="linenr"> 155</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;buf,&nbsp;0,&nbsp;sizeof&nbsp;buf);</div>
<div class="pre"><a id="l156" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l156" class="linenr"> 156</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.type&nbsp;=&nbsp;V4L2_BUF_TYPE_VIDEO_OUTPUT;</div>
<div class="pre"><a id="l157" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l157" class="linenr"> 157</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.memory&nbsp;=&nbsp;V4L2_MEMORY_MMAP;</div>
<div class="pre"><a id="l158" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l158" class="linenr"> 158</a> </div>
<div class="pre"><a id="l159" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l159" class="linenr"> 159</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ret&nbsp;=&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_DQBUF,&nbsp;&amp;buf))&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l160" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l160" class="linenr"> 160</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;dequeue&nbsp;buffer:&nbsp;%s&nbsp;(%d).\n&quot;,&nbsp;strerror(errno),</div>
<div class="pre"><a id="l161" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l161" class="linenr"> 161</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errno);</div>
<div class="pre"><a id="l162" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l162" class="linenr"> 162</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret;</div>
<div class="pre"><a id="l163" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l163" class="linenr"> 163</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l164" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l164" class="linenr"> 164</a> </div>
<div class="pre"><a id="l165" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l165" class="linenr"> 165</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_fill_buffer(dev,&nbsp;&amp;buf);</div>
<div class="pre"><a id="l166" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l166" class="linenr"> 166</a> </div>
<div class="pre"><a id="l167" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l167" class="linenr"> 167</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ret&nbsp;=&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_QBUF,&nbsp;&amp;buf))&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l168" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l168" class="linenr"> 168</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;requeue&nbsp;buffer:&nbsp;%s&nbsp;(%d).\n&quot;,&nbsp;strerror(errno),</div>
<div class="pre"><a id="l169" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l169" class="linenr"> 169</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errno);</div>
<div class="pre"><a id="l170" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l170" class="linenr"> 170</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret;</div>
<div class="pre"><a id="l171" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l171" class="linenr"> 171</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l172" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l172" class="linenr"> 172</a> </div>
<div class="pre"><a id="l173" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l173" class="linenr"> 173</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</div>
<div class="pre"><a id="l174" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l174" class="linenr"> 174</a> }</div>
<div class="pre"><a id="l175" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l175" class="linenr"> 175</a> </div>
<div class="pre"><a id="l176" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l176" class="linenr"> 176</a> static&nbsp;int</div>
<div class="pre"><a id="l177" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l177" class="linenr"> 177</a> uvc_video_reqbufs(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;int&nbsp;nbufs)</div>
<div class="pre"><a id="l178" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l178" class="linenr"> 178</a> {</div>
<div class="pre"><a id="l179" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l179" class="linenr"> 179</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_requestbuffers&nbsp;rb;</div>
<div class="pre"><a id="l180" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l180" class="linenr"> 180</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_buffer&nbsp;buf;</div>
<div class="pre"><a id="l181" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l181" class="linenr"> 181</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;i;</div>
<div class="pre"><a id="l182" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l182" class="linenr"> 182</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;ret;</div>
<div class="pre"><a id="l183" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l183" class="linenr"> 183</a> </div>
<div class="pre"><a id="l184" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l184" class="linenr"> 184</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;dev-&gt;nbufs;&nbsp;++i)</div>
<div class="pre"><a id="l185" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l185" class="linenr"> 185</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;munmap(dev-&gt;mem[i],&nbsp;dev-&gt;bufsize);</div>
<div class="pre"><a id="l186" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l186" class="linenr"> 186</a> </div>
<div class="pre"><a id="l187" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l187" class="linenr"> 187</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;free(dev-&gt;mem);</div>
<div class="pre"><a id="l188" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l188" class="linenr"> 188</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;mem&nbsp;=&nbsp;0;</div>
<div class="pre"><a id="l189" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l189" class="linenr"> 189</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;nbufs&nbsp;=&nbsp;0;</div>
<div class="pre"><a id="l190" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l190" class="linenr"> 190</a> </div>
<div class="pre"><a id="l191" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l191" class="linenr"> 191</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;rb,&nbsp;0,&nbsp;sizeof&nbsp;rb);</div>
<div class="pre"><a id="l192" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l192" class="linenr"> 192</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rb.count&nbsp;=&nbsp;nbufs;</div>
<div class="pre"><a id="l193" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l193" class="linenr"> 193</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rb.type&nbsp;=&nbsp;V4L2_BUF_TYPE_VIDEO_OUTPUT;</div>
<div class="pre"><a id="l194" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l194" class="linenr"> 194</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rb.memory&nbsp;=&nbsp;V4L2_MEMORY_MMAP;</div>
<div class="pre"><a id="l195" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l195" class="linenr"> 195</a> </div>
<div class="pre"><a id="l196" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l196" class="linenr"> 196</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_REQBUFS,&nbsp;&amp;rb);</div>
<div class="pre"><a id="l197" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l197" class="linenr"> 197</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ret&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l198" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l198" class="linenr"> 198</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;allocate&nbsp;buffers:&nbsp;%s&nbsp;(%d).\n&quot;,</div>
<div class="pre"><a id="l199" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l199" class="linenr"> 199</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strerror(errno),&nbsp;errno);</div>
<div class="pre"><a id="l200" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l200" class="linenr"> 200</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret;</div>
<div class="pre"><a id="l201" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l201" class="linenr"> 201</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l202" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l202" class="linenr"> 202</a> </div>
<div class="pre"><a id="l203" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l203" class="linenr"> 203</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;%u&nbsp;buffers&nbsp;allocated.\n&quot;,&nbsp;rb.count);</div>
<div class="pre"><a id="l204" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l204" class="linenr"> 204</a> </div>
<div class="pre"><a id="l205" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l205" class="linenr"> 205</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;Map&nbsp;the&nbsp;buffers.&nbsp;*/</div>
<div class="pre"><a id="l206" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l206" class="linenr"> 206</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;mem&nbsp;=&nbsp;malloc(rb.count&nbsp;*&nbsp;sizeof&nbsp;dev-&gt;mem[0]);</div>
<div class="pre"><a id="l207" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l207" class="linenr"> 207</a> </div>
<div class="pre"><a id="l208" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l208" class="linenr"> 208</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;rb.count;&nbsp;++i)&nbsp;{</div>
<div class="pre"><a id="l209" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l209" class="linenr"> 209</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;buf,&nbsp;0,&nbsp;sizeof&nbsp;buf);</div>
<div class="pre"><a id="l210" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l210" class="linenr"> 210</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.index&nbsp;=&nbsp;i;</div>
<div class="pre"><a id="l211" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l211" class="linenr"> 211</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.type&nbsp;=&nbsp;V4L2_BUF_TYPE_VIDEO_OUTPUT;</div>
<div class="pre"><a id="l212" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l212" class="linenr"> 212</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.memory&nbsp;=&nbsp;V4L2_MEMORY_MMAP;</div>
<div class="pre"><a id="l213" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l213" class="linenr"> 213</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_QUERYBUF,&nbsp;&amp;buf);</div>
<div class="pre"><a id="l214" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l214" class="linenr"> 214</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ret&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l215" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l215" class="linenr"> 215</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;query&nbsp;buffer&nbsp;%u:&nbsp;%s&nbsp;(%d).\n&quot;,&nbsp;i,</div>
<div class="pre"><a id="l216" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l216" class="linenr"> 216</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strerror(errno),&nbsp;errno);</div>
<div class="pre"><a id="l217" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l217" class="linenr"> 217</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</div>
<div class="pre"><a id="l218" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l218" class="linenr"> 218</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l219" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l219" class="linenr"> 219</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;length:&nbsp;%u&nbsp;offset:&nbsp;%u\n&quot;,&nbsp;buf.length,&nbsp;buf.m.offset);</div>
<div class="pre"><a id="l220" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l220" class="linenr"> 220</a> </div>
<div class="pre"><a id="l221" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l221" class="linenr"> 221</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;mem[i]&nbsp;=&nbsp;mmap(0,&nbsp;buf.length,&nbsp;PROT_READ&nbsp;|&nbsp;PROT_WRITE,&nbsp;MAP_SHARED,&nbsp;dev-&gt;fd,&nbsp;buf.m.offset);</div>
<div class="pre"><a id="l222" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l222" class="linenr"> 222</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev-&gt;mem[i]&nbsp;==&nbsp;MAP_FAILED)&nbsp;{</div>
<div class="pre"><a id="l223" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l223" class="linenr"> 223</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;map&nbsp;buffer&nbsp;%u:&nbsp;%s&nbsp;(%d)\n&quot;,&nbsp;i,</div>
<div class="pre"><a id="l224" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l224" class="linenr"> 224</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strerror(errno),&nbsp;errno);</div>
<div class="pre"><a id="l225" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l225" class="linenr"> 225</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;-1;</div>
<div class="pre"><a id="l226" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l226" class="linenr"> 226</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l227" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l227" class="linenr"> 227</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Buffer&nbsp;%u&nbsp;mapped&nbsp;at&nbsp;address&nbsp;%p.\n&quot;,&nbsp;i,&nbsp;dev-&gt;mem[i]);</div>
<div class="pre"><a id="l228" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l228" class="linenr"> 228</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l229" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l229" class="linenr"> 229</a> </div>
<div class="pre"><a id="l230" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l230" class="linenr"> 230</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;bufsize&nbsp;=&nbsp;buf.length;</div>
<div class="pre"><a id="l231" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l231" class="linenr"> 231</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;nbufs&nbsp;=&nbsp;rb.count;</div>
<div class="pre"><a id="l232" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l232" class="linenr"> 232</a> </div>
<div class="pre"><a id="l233" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l233" class="linenr"> 233</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</div>
<div class="pre"><a id="l234" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l234" class="linenr"> 234</a> }</div>
<div class="pre"><a id="l235" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l235" class="linenr"> 235</a> </div>
<div class="pre"><a id="l236" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l236" class="linenr"> 236</a> static&nbsp;int</div>
<div class="pre"><a id="l237" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l237" class="linenr"> 237</a> uvc_video_stream(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;int&nbsp;enable)</div>
<div class="pre"><a id="l238" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l238" class="linenr"> 238</a> {</div>
<div class="pre"><a id="l239" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l239" class="linenr"> 239</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_buffer&nbsp;buf;</div>
<div class="pre"><a id="l240" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l240" class="linenr"> 240</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;i;</div>
<div class="pre"><a id="l241" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l241" class="linenr"> 241</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;type&nbsp;=&nbsp;V4L2_BUF_TYPE_VIDEO_OUTPUT;</div>
<div class="pre"><a id="l242" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l242" class="linenr"> 242</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;ret;</div>
<div class="pre"><a id="l243" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l243" class="linenr"> 243</a> </div>
<div class="pre"><a id="l244" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l244" class="linenr"> 244</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!enable)&nbsp;{</div>
<div class="pre"><a id="l245" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l245" class="linenr"> 245</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Stopping&nbsp;video&nbsp;stream.\n&quot;);</div>
<div class="pre"><a id="l246" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l246" class="linenr"> 246</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_STREAMOFF,&nbsp;&amp;type);</div>
<div class="pre"><a id="l247" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l247" class="linenr"> 247</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</div>
<div class="pre"><a id="l248" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l248" class="linenr"> 248</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l249" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l249" class="linenr"> 249</a> </div>
<div class="pre"><a id="l250" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l250" class="linenr"> 250</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Starting&nbsp;video&nbsp;stream.\n&quot;);</div>
<div class="pre"><a id="l251" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l251" class="linenr"> 251</a> </div>
<div class="pre"><a id="l252" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l252" class="linenr"> 252</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;dev-&gt;nbufs;&nbsp;++i)&nbsp;{</div>
<div class="pre"><a id="l253" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l253" class="linenr"> 253</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;buf,&nbsp;0,&nbsp;sizeof&nbsp;buf);</div>
<div class="pre"><a id="l254" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l254" class="linenr"> 254</a> </div>
<div class="pre"><a id="l255" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l255" class="linenr"> 255</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.index&nbsp;=&nbsp;i;</div>
<div class="pre"><a id="l256" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l256" class="linenr"> 256</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.type&nbsp;=&nbsp;V4L2_BUF_TYPE_VIDEO_OUTPUT;</div>
<div class="pre"><a id="l257" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l257" class="linenr"> 257</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buf.memory&nbsp;=&nbsp;V4L2_MEMORY_MMAP;</div>
<div class="pre"><a id="l258" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l258" class="linenr"> 258</a> </div>
<div class="pre"><a id="l259" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l259" class="linenr"> 259</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_fill_buffer(dev,&nbsp;&amp;buf);</div>
<div class="pre"><a id="l260" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l260" class="linenr"> 260</a> </div>
<div class="pre"><a id="l261" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l261" class="linenr"> 261</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Queueing&nbsp;buffer&nbsp;%u.\n&quot;,&nbsp;i);</div>
<div class="pre"><a id="l262" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l262" class="linenr"> 262</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ret&nbsp;=&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_QBUF,&nbsp;&amp;buf))&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l263" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l263" class="linenr"> 263</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;queue&nbsp;buffer:&nbsp;%s&nbsp;(%d).\n&quot;,</div>
<div class="pre"><a id="l264" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l264" class="linenr"> 264</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strerror(errno),&nbsp;errno);</div>
<div class="pre"><a id="l265" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l265" class="linenr"> 265</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l266" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l266" class="linenr"> 266</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l267" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l267" class="linenr"> 267</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l268" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l268" class="linenr"> 268</a> </div>
<div class="pre"><a id="l269" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l269" class="linenr"> 269</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_STREAMON,&nbsp;&amp;type);</div>
<div class="pre"><a id="l270" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l270" class="linenr"> 270</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret;</div>
<div class="pre"><a id="l271" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l271" class="linenr"> 271</a> }</div>
<div class="pre"><a id="l272" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l272" class="linenr"> 272</a> </div>
<div class="pre"><a id="l273" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l273" class="linenr"> 273</a> static&nbsp;int</div>
<div class="pre"><a id="l274" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l274" class="linenr"> 274</a> uvc_video_set_format(struct&nbsp;uvc_device&nbsp;*dev)</div>
<div class="pre"><a id="l275" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l275" class="linenr"> 275</a> {</div>
<div class="pre"><a id="l276" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l276" class="linenr"> 276</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_format&nbsp;fmt;</div>
<div class="pre"><a id="l277" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l277" class="linenr"> 277</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;ret;</div>
<div class="pre"><a id="l278" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l278" class="linenr"> 278</a> </div>
<div class="pre"><a id="l279" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l279" class="linenr"> 279</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Setting&nbsp;format&nbsp;to&nbsp;0x%08x&nbsp;%ux%u\n&quot;,</div>
<div class="pre"><a id="l280" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l280" class="linenr"> 280</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;fcc,&nbsp;dev-&gt;width,&nbsp;dev-&gt;height);</div>
<div class="pre"><a id="l281" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l281" class="linenr"> 281</a> </div>
<div class="pre"><a id="l282" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l282" class="linenr"> 282</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;fmt,&nbsp;0,&nbsp;sizeof&nbsp;fmt);</div>
<div class="pre"><a id="l283" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l283" class="linenr"> 283</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.type&nbsp;=&nbsp;V4L2_BUF_TYPE_VIDEO_OUTPUT;</div>
<div class="pre"><a id="l284" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l284" class="linenr"> 284</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.fmt.pix.width&nbsp;=&nbsp;dev-&gt;width;</div>
<div class="pre"><a id="l285" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l285" class="linenr"> 285</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.fmt.pix.height&nbsp;=&nbsp;dev-&gt;height;</div>
<div class="pre"><a id="l286" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l286" class="linenr"> 286</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.fmt.pix.pixelformat&nbsp;=&nbsp;dev-&gt;fcc;</div>
<div class="pre"><a id="l287" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l287" class="linenr"> 287</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.fmt.pix.field&nbsp;=&nbsp;V4L2_FIELD_NONE;</div>
<div class="pre"><a id="l288" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l288" class="linenr"> 288</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev-&gt;fcc&nbsp;==&nbsp;V4L2_PIX_FMT_MJPEG)</div>
<div class="pre"><a id="l289" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l289" class="linenr"> 289</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fmt.fmt.pix.sizeimage&nbsp;=&nbsp;dev-&gt;imgsize&nbsp;*&nbsp;1.5;</div>
<div class="pre"><a id="l290" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l290" class="linenr"> 290</a> </div>
<div class="pre"><a id="l291" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l291" class="linenr"> 291</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ret&nbsp;=&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_S_FMT,&nbsp;&amp;fmt))&nbsp;&lt;&nbsp;0)</div>
<div class="pre"><a id="l292" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l292" class="linenr"> 292</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;set&nbsp;format:&nbsp;%s&nbsp;(%d).\n&quot;,</div>
<div class="pre"><a id="l293" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l293" class="linenr"> 293</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strerror(errno),&nbsp;errno);</div>
<div class="pre"><a id="l294" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l294" class="linenr"> 294</a> </div>
<div class="pre"><a id="l295" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l295" class="linenr"> 295</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;ret;</div>
<div class="pre"><a id="l296" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l296" class="linenr"> 296</a> }</div>
<div class="pre"><a id="l297" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l297" class="linenr"> 297</a> </div>
<div class="pre"><a id="l298" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l298" class="linenr"> 298</a> static&nbsp;int</div>
<div class="pre"><a id="l299" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l299" class="linenr"> 299</a> uvc_video_init(struct&nbsp;uvc_device&nbsp;*dev&nbsp;__attribute__((__unused__)))</div>
<div class="pre"><a id="l300" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l300" class="linenr"> 300</a> {</div>
<div class="pre"><a id="l301" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l301" class="linenr"> 301</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</div>
<div class="pre"><a id="l302" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l302" class="linenr"> 302</a> }</div>
<div class="pre"><a id="l303" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l303" class="linenr"> 303</a> </div>
<div class="pre"><a id="l304" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l304" class="linenr"> 304</a> /*&nbsp;---------------------------------------------------------------------------</div>
<div class="pre"><a id="l305" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l305" class="linenr"> 305</a> &nbsp;*&nbsp;Request&nbsp;processing</div>
<div class="pre"><a id="l306" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l306" class="linenr"> 306</a> &nbsp;*/</div>
<div class="pre"><a id="l307" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l307" class="linenr"> 307</a> </div>
<div class="pre"><a id="l308" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l308" class="linenr"> 308</a> struct&nbsp;uvc_frame_info</div>
<div class="pre"><a id="l309" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l309" class="linenr"> 309</a> {</div>
<div class="pre"><a id="l310" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l310" class="linenr"> 310</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;width;</div>
<div class="pre"><a id="l311" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l311" class="linenr"> 311</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;height;</div>
<div class="pre"><a id="l312" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l312" class="linenr"> 312</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;intervals[8];</div>
<div class="pre"><a id="l313" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l313" class="linenr"> 313</a> };</div>
<div class="pre"><a id="l314" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l314" class="linenr"> 314</a> </div>
<div class="pre"><a id="l315" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l315" class="linenr"> 315</a> struct&nbsp;uvc_format_info</div>
<div class="pre"><a id="l316" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l316" class="linenr"> 316</a> {</div>
<div class="pre"><a id="l317" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l317" class="linenr"> 317</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;fcc;</div>
<div class="pre"><a id="l318" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l318" class="linenr"> 318</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;struct&nbsp;uvc_frame_info&nbsp;*frames;</div>
<div class="pre"><a id="l319" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l319" class="linenr"> 319</a> };</div>
<div class="pre"><a id="l320" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l320" class="linenr"> 320</a> </div>
<div class="pre"><a id="l321" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l321" class="linenr"> 321</a> static&nbsp;const&nbsp;struct&nbsp;uvc_frame_info&nbsp;uvc_frames_yuyv[]&nbsp;=&nbsp;{</div>
<div class="pre"><a id="l322" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l322" class="linenr"> 322</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;640,&nbsp;360,&nbsp;{&nbsp;666666,&nbsp;10000000,&nbsp;50000000,&nbsp;0&nbsp;},&nbsp;},</div>
<div class="pre"><a id="l323" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l323" class="linenr"> 323</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;1280,&nbsp;720,&nbsp;{&nbsp;50000000,&nbsp;0&nbsp;},&nbsp;},</div>
<div class="pre"><a id="l324" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l324" class="linenr"> 324</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;0,&nbsp;0,&nbsp;{&nbsp;0,&nbsp;},&nbsp;},</div>
<div class="pre"><a id="l325" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l325" class="linenr"> 325</a> };</div>
<div class="pre"><a id="l326" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l326" class="linenr"> 326</a> </div>
<div class="pre"><a id="l327" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l327" class="linenr"> 327</a> static&nbsp;const&nbsp;struct&nbsp;uvc_frame_info&nbsp;uvc_frames_mjpeg[]&nbsp;=&nbsp;{</div>
<div class="pre"><a id="l328" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l328" class="linenr"> 328</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;640,&nbsp;360,&nbsp;{&nbsp;666666,&nbsp;10000000,&nbsp;50000000,&nbsp;0&nbsp;},&nbsp;},</div>
<div class="pre"><a id="l329" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l329" class="linenr"> 329</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;1280,&nbsp;720,&nbsp;{&nbsp;50000000,&nbsp;0&nbsp;},&nbsp;},</div>
<div class="pre"><a id="l330" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l330" class="linenr"> 330</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;0,&nbsp;0,&nbsp;{&nbsp;0,&nbsp;},&nbsp;},</div>
<div class="pre"><a id="l331" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l331" class="linenr"> 331</a> };</div>
<div class="pre"><a id="l332" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l332" class="linenr"> 332</a> </div>
<div class="pre"><a id="l333" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l333" class="linenr"> 333</a> static&nbsp;const&nbsp;struct&nbsp;uvc_format_info&nbsp;uvc_formats[]&nbsp;=&nbsp;{</div>
<div class="pre"><a id="l334" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l334" class="linenr"> 334</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;V4L2_PIX_FMT_YUYV,&nbsp;uvc_frames_yuyv&nbsp;},</div>
<div class="pre"><a id="l335" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l335" class="linenr"> 335</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;V4L2_PIX_FMT_MJPEG,&nbsp;uvc_frames_mjpeg&nbsp;},</div>
<div class="pre"><a id="l336" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l336" class="linenr"> 336</a> };</div>
<div class="pre"><a id="l337" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l337" class="linenr"> 337</a> </div>
<div class="pre"><a id="l338" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l338" class="linenr"> 338</a> static&nbsp;void</div>
<div class="pre"><a id="l339" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l339" class="linenr"> 339</a> uvc_fill_streaming_control(struct&nbsp;uvc_device&nbsp;*dev,</div>
<div class="pre"><a id="l340" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l340" class="linenr"> 340</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_streaming_control&nbsp;*ctrl,</div>
<div class="pre"><a id="l341" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l341" class="linenr"> 341</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;iframe,&nbsp;int&nbsp;iformat)</div>
<div class="pre"><a id="l342" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l342" class="linenr"> 342</a> {</div>
<div class="pre"><a id="l343" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l343" class="linenr"> 343</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;struct&nbsp;uvc_format_info&nbsp;*format;</div>
<div class="pre"><a id="l344" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l344" class="linenr"> 344</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;struct&nbsp;uvc_frame_info&nbsp;*frame;</div>
<div class="pre"><a id="l345" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l345" class="linenr"> 345</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;nframes;</div>
<div class="pre"><a id="l346" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l346" class="linenr"> 346</a> </div>
<div class="pre"><a id="l347" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l347" class="linenr"> 347</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(iformat&nbsp;&lt;&nbsp;0)</div>
<div class="pre"><a id="l348" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l348" class="linenr"> 348</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iformat&nbsp;=&nbsp;ARRAY_SIZE(uvc_formats)&nbsp;+&nbsp;iformat;</div>
<div class="pre"><a id="l349" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l349" class="linenr"> 349</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(iformat&nbsp;&lt;&nbsp;0&nbsp;||&nbsp;iformat&nbsp;&gt;=&nbsp;(int)ARRAY_SIZE(uvc_formats))</div>
<div class="pre"><a id="l350" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l350" class="linenr"> 350</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l351" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l351" class="linenr"> 351</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;=&nbsp;&amp;uvc_formats[iformat];</div>
<div class="pre"><a id="l352" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l352" class="linenr"> 352</a> </div>
<div class="pre"><a id="l353" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l353" class="linenr"> 353</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nframes&nbsp;=&nbsp;0;</div>
<div class="pre"><a id="l354" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l354" class="linenr"> 354</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(format-&gt;frames[nframes].width&nbsp;!=&nbsp;0)</div>
<div class="pre"><a id="l355" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l355" class="linenr"> 355</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++nframes;</div>
<div class="pre"><a id="l356" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l356" class="linenr"> 356</a> </div>
<div class="pre"><a id="l357" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l357" class="linenr"> 357</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(iframe&nbsp;&lt;&nbsp;0)</div>
<div class="pre"><a id="l358" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l358" class="linenr"> 358</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iframe&nbsp;=&nbsp;nframes&nbsp;+&nbsp;iframe;</div>
<div class="pre"><a id="l359" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l359" class="linenr"> 359</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(iframe&nbsp;&lt;&nbsp;0&nbsp;||&nbsp;iframe&nbsp;&gt;=&nbsp;(int)nframes)</div>
<div class="pre"><a id="l360" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l360" class="linenr"> 360</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l361" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l361" class="linenr"> 361</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;=&nbsp;&amp;format-&gt;frames[iframe];</div>
<div class="pre"><a id="l362" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l362" class="linenr"> 362</a> </div>
<div class="pre"><a id="l363" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l363" class="linenr"> 363</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(ctrl,&nbsp;0,&nbsp;sizeof&nbsp;*ctrl);</div>
<div class="pre"><a id="l364" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l364" class="linenr"> 364</a> </div>
<div class="pre"><a id="l365" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l365" class="linenr"> 365</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;bmHint&nbsp;=&nbsp;1;</div>
<div class="pre"><a id="l366" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l366" class="linenr"> 366</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;bFormatIndex&nbsp;=&nbsp;iformat&nbsp;+&nbsp;1;</div>
<div class="pre"><a id="l367" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l367" class="linenr"> 367</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;bFrameIndex&nbsp;=&nbsp;iframe&nbsp;+&nbsp;1;</div>
<div class="pre"><a id="l368" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l368" class="linenr"> 368</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;dwFrameInterval&nbsp;=&nbsp;frame-&gt;intervals[0];</div>
<div class="pre"><a id="l369" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l369" class="linenr"> 369</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(format-&gt;fcc)&nbsp;{</div>
<div class="pre"><a id="l370" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l370" class="linenr"> 370</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;V4L2_PIX_FMT_YUYV:</div>
<div class="pre"><a id="l371" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l371" class="linenr"> 371</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;dwMaxVideoFrameSize&nbsp;=&nbsp;frame-&gt;width&nbsp;*&nbsp;frame-&gt;height&nbsp;*&nbsp;2;</div>
<div class="pre"><a id="l372" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l372" class="linenr"> 372</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l373" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l373" class="linenr"> 373</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;V4L2_PIX_FMT_MJPEG:</div>
<div class="pre"><a id="l374" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l374" class="linenr"> 374</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;dwMaxVideoFrameSize&nbsp;=&nbsp;dev-&gt;imgsize;</div>
<div class="pre"><a id="l375" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l375" class="linenr"> 375</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l376" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l376" class="linenr"> 376</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l377" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l377" class="linenr"> 377</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;dwMaxPayloadTransferSize&nbsp;=&nbsp;512;&nbsp;&nbsp;&nbsp;/*&nbsp;TODO&nbsp;this&nbsp;should&nbsp;be&nbsp;filled&nbsp;by&nbsp;the&nbsp;driver.&nbsp;*/</div>
<div class="pre"><a id="l378" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l378" class="linenr"> 378</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;bmFramingInfo&nbsp;=&nbsp;3;</div>
<div class="pre"><a id="l379" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l379" class="linenr"> 379</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;bPreferedVersion&nbsp;=&nbsp;1;</div>
<div class="pre"><a id="l380" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l380" class="linenr"> 380</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;bMaxVersion&nbsp;=&nbsp;1;</div>
<div class="pre"><a id="l381" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l381" class="linenr"> 381</a> }</div>
<div class="pre"><a id="l382" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l382" class="linenr"> 382</a> </div>
<div class="pre"><a id="l383" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l383" class="linenr"> 383</a> static&nbsp;void</div>
<div class="pre"><a id="l384" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l384" class="linenr"> 384</a> uvc_events_process_standard(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;struct&nbsp;usb_ctrlrequest&nbsp;*ctrl,</div>
<div class="pre"><a id="l385" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l385" class="linenr"> 385</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_request_data&nbsp;*resp)</div>
<div class="pre"><a id="l386" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l386" class="linenr"> 386</a> {</div>
<div class="pre"><a id="l387" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l387" class="linenr"> 387</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;standard&nbsp;request\n&quot;);</div>
<div class="pre"><a id="l388" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l388" class="linenr"> 388</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)dev;</div>
<div class="pre"><a id="l389" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l389" class="linenr"> 389</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)ctrl;</div>
<div class="pre"><a id="l390" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l390" class="linenr"> 390</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)resp;</div>
<div class="pre"><a id="l391" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l391" class="linenr"> 391</a> }</div>
<div class="pre"><a id="l392" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l392" class="linenr"> 392</a> </div>
<div class="pre"><a id="l393" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l393" class="linenr"> 393</a> static&nbsp;void</div>
<div class="pre"><a id="l394" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l394" class="linenr"> 394</a> uvc_events_process_control(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;uint8_t&nbsp;req,&nbsp;uint8_t&nbsp;cs,</div>
<div class="pre"><a id="l395" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l395" class="linenr"> 395</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_request_data&nbsp;*resp)</div>
<div class="pre"><a id="l396" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l396" class="linenr"> 396</a> {</div>
<div class="pre"><a id="l397" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l397" class="linenr"> 397</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;control&nbsp;request&nbsp;(req&nbsp;%02x&nbsp;cs&nbsp;%02x)\n&quot;,&nbsp;req,&nbsp;cs);</div>
<div class="pre"><a id="l398" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l398" class="linenr"> 398</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)dev;</div>
<div class="pre"><a id="l399" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l399" class="linenr"> 399</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(void)resp;</div>
<div class="pre"><a id="l400" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l400" class="linenr"> 400</a> }</div>
<div class="pre"><a id="l401" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l401" class="linenr"> 401</a> </div>
<div class="pre"><a id="l402" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l402" class="linenr"> 402</a> static&nbsp;void</div>
<div class="pre"><a id="l403" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l403" class="linenr"> 403</a> uvc_events_process_streaming(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;uint8_t&nbsp;req,&nbsp;uint8_t&nbsp;cs,</div>
<div class="pre"><a id="l404" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l404" class="linenr"> 404</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_request_data&nbsp;*resp)</div>
<div class="pre"><a id="l405" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l405" class="linenr"> 405</a> {</div>
<div class="pre"><a id="l406" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l406" class="linenr"> 406</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_streaming_control&nbsp;*ctrl;</div>
<div class="pre"><a id="l407" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l407" class="linenr"> 407</a> </div>
<div class="pre"><a id="l408" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l408" class="linenr"> 408</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;streaming&nbsp;request&nbsp;(req&nbsp;%02x&nbsp;cs&nbsp;%02x)\n&quot;,&nbsp;req,&nbsp;cs);</div>
<div class="pre"><a id="l409" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l409" class="linenr"> 409</a> </div>
<div class="pre"><a id="l410" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l410" class="linenr"> 410</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cs&nbsp;!=&nbsp;UVC_VS_PROBE_CONTROL&nbsp;&amp;&amp;&nbsp;cs&nbsp;!=&nbsp;UVC_VS_COMMIT_CONTROL)</div>
<div class="pre"><a id="l411" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l411" class="linenr"> 411</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l412" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l412" class="linenr"> 412</a> </div>
<div class="pre"><a id="l413" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l413" class="linenr"> 413</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl&nbsp;=&nbsp;(struct&nbsp;uvc_streaming_control&nbsp;*)&amp;resp-&gt;data;</div>
<div class="pre"><a id="l414" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l414" class="linenr"> 414</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp-&gt;length&nbsp;=&nbsp;sizeof&nbsp;*ctrl;</div>
<div class="pre"><a id="l415" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l415" class="linenr"> 415</a> </div>
<div class="pre"><a id="l416" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l416" class="linenr"> 416</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(req)&nbsp;{</div>
<div class="pre"><a id="l417" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l417" class="linenr"> 417</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_SET_CUR:</div>
<div class="pre"><a id="l418" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l418" class="linenr"> 418</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;control&nbsp;=&nbsp;cs;</div>
<div class="pre"><a id="l419" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l419" class="linenr"> 419</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp-&gt;length&nbsp;=&nbsp;34;</div>
<div class="pre"><a id="l420" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l420" class="linenr"> 420</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l421" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l421" class="linenr"> 421</a> </div>
<div class="pre"><a id="l422" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l422" class="linenr"> 422</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_GET_CUR:</div>
<div class="pre"><a id="l423" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l423" class="linenr"> 423</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(cs&nbsp;==&nbsp;UVC_VS_PROBE_CONTROL)</div>
<div class="pre"><a id="l424" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l424" class="linenr"> 424</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(ctrl,&nbsp;&amp;dev-&gt;probe,&nbsp;sizeof&nbsp;*ctrl);</div>
<div class="pre"><a id="l425" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l425" class="linenr"> 425</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else</div>
<div class="pre"><a id="l426" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l426" class="linenr"> 426</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(ctrl,&nbsp;&amp;dev-&gt;commit,&nbsp;sizeof&nbsp;*ctrl);</div>
<div class="pre"><a id="l427" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l427" class="linenr"> 427</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l428" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l428" class="linenr"> 428</a> </div>
<div class="pre"><a id="l429" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l429" class="linenr"> 429</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_GET_MIN:</div>
<div class="pre"><a id="l430" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l430" class="linenr"> 430</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_GET_MAX:</div>
<div class="pre"><a id="l431" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l431" class="linenr"> 431</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_GET_DEF:</div>
<div class="pre"><a id="l432" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l432" class="linenr"> 432</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_fill_streaming_control(dev,&nbsp;ctrl,&nbsp;req&nbsp;==&nbsp;UVC_GET_MAX&nbsp;?&nbsp;-1&nbsp;:&nbsp;0,</div>
<div class="pre"><a id="l433" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l433" class="linenr"> 433</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req&nbsp;==&nbsp;UVC_GET_MAX&nbsp;?&nbsp;-1&nbsp;:&nbsp;0);</div>
<div class="pre"><a id="l434" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l434" class="linenr"> 434</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l435" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l435" class="linenr"> 435</a> </div>
<div class="pre"><a id="l436" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l436" class="linenr"> 436</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_GET_RES:</div>
<div class="pre"><a id="l437" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l437" class="linenr"> 437</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(ctrl,&nbsp;0,&nbsp;sizeof&nbsp;*ctrl);</div>
<div class="pre"><a id="l438" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l438" class="linenr"> 438</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l439" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l439" class="linenr"> 439</a> </div>
<div class="pre"><a id="l440" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l440" class="linenr"> 440</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_GET_LEN:</div>
<div class="pre"><a id="l441" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l441" class="linenr"> 441</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp-&gt;data[0]&nbsp;=&nbsp;0x00;</div>
<div class="pre"><a id="l442" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l442" class="linenr"> 442</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp-&gt;data[1]&nbsp;=&nbsp;0x22;</div>
<div class="pre"><a id="l443" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l443" class="linenr"> 443</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp-&gt;length&nbsp;=&nbsp;2;</div>
<div class="pre"><a id="l444" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l444" class="linenr"> 444</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l445" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l445" class="linenr"> 445</a> </div>
<div class="pre"><a id="l446" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l446" class="linenr"> 446</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_GET_INFO:</div>
<div class="pre"><a id="l447" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l447" class="linenr"> 447</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp-&gt;data[0]&nbsp;=&nbsp;0x03;</div>
<div class="pre"><a id="l448" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l448" class="linenr"> 448</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp-&gt;length&nbsp;=&nbsp;1;</div>
<div class="pre"><a id="l449" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l449" class="linenr"> 449</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l450" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l450" class="linenr"> 450</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l451" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l451" class="linenr"> 451</a> }</div>
<div class="pre"><a id="l452" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l452" class="linenr"> 452</a> </div>
<div class="pre"><a id="l453" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l453" class="linenr"> 453</a> static&nbsp;void</div>
<div class="pre"><a id="l454" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l454" class="linenr"> 454</a> uvc_events_process_class(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;struct&nbsp;usb_ctrlrequest&nbsp;*ctrl,</div>
<div class="pre"><a id="l455" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l455" class="linenr"> 455</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_request_data&nbsp;*resp)</div>
<div class="pre"><a id="l456" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l456" class="linenr"> 456</a> {</div>
<div class="pre"><a id="l457" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l457" class="linenr"> 457</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((ctrl-&gt;bRequestType&nbsp;&amp;&nbsp;USB_RECIP_MASK)&nbsp;!=&nbsp;USB_RECIP_INTERFACE)</div>
<div class="pre"><a id="l458" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l458" class="linenr"> 458</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l459" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l459" class="linenr"> 459</a> </div>
<div class="pre"><a id="l460" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l460" class="linenr"> 460</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(ctrl-&gt;wIndex&nbsp;&amp;&nbsp;0xff)&nbsp;{</div>
<div class="pre"><a id="l461" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l461" class="linenr"> 461</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_INTF_CONTROL:</div>
<div class="pre"><a id="l462" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l462" class="linenr"> 462</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_process_control(dev,&nbsp;ctrl-&gt;bRequest,&nbsp;ctrl-&gt;wValue&nbsp;&gt;&gt;&nbsp;8,&nbsp;resp);</div>
<div class="pre"><a id="l463" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l463" class="linenr"> 463</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l464" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l464" class="linenr"> 464</a> </div>
<div class="pre"><a id="l465" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l465" class="linenr"> 465</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_INTF_STREAMING:</div>
<div class="pre"><a id="l466" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l466" class="linenr"> 466</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_process_streaming(dev,&nbsp;ctrl-&gt;bRequest,&nbsp;ctrl-&gt;wValue&nbsp;&gt;&gt;&nbsp;8,&nbsp;resp);</div>
<div class="pre"><a id="l467" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l467" class="linenr"> 467</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l468" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l468" class="linenr"> 468</a> </div>
<div class="pre"><a id="l469" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l469" class="linenr"> 469</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</div>
<div class="pre"><a id="l470" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l470" class="linenr"> 470</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l471" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l471" class="linenr"> 471</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l472" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l472" class="linenr"> 472</a> }</div>
<div class="pre"><a id="l473" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l473" class="linenr"> 473</a> </div>
<div class="pre"><a id="l474" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l474" class="linenr"> 474</a> static&nbsp;void</div>
<div class="pre"><a id="l475" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l475" class="linenr"> 475</a> uvc_events_process_setup(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;struct&nbsp;usb_ctrlrequest&nbsp;*ctrl,</div>
<div class="pre"><a id="l476" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l476" class="linenr"> 476</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_request_data&nbsp;*resp)</div>
<div class="pre"><a id="l477" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l477" class="linenr"> 477</a> {</div>
<div class="pre"><a id="l478" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l478" class="linenr"> 478</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;control&nbsp;=&nbsp;0;</div>
<div class="pre"><a id="l479" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l479" class="linenr"> 479</a> </div>
<div class="pre"><a id="l480" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l480" class="linenr"> 480</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;bRequestType&nbsp;%02x&nbsp;bRequest&nbsp;%02x&nbsp;wValue&nbsp;%04x&nbsp;wIndex&nbsp;%04x&nbsp;&quot;</div>
<div class="pre"><a id="l481" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l481" class="linenr"> 481</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;wLength&nbsp;%04x\n&quot;,&nbsp;ctrl-&gt;bRequestType,&nbsp;ctrl-&gt;bRequest,</div>
<div class="pre"><a id="l482" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l482" class="linenr"> 482</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl-&gt;wValue,&nbsp;ctrl-&gt;wIndex,&nbsp;ctrl-&gt;wLength);</div>
<div class="pre"><a id="l483" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l483" class="linenr"> 483</a> </div>
<div class="pre"><a id="l484" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l484" class="linenr"> 484</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(ctrl-&gt;bRequestType&nbsp;&amp;&nbsp;USB_TYPE_MASK)&nbsp;{</div>
<div class="pre"><a id="l485" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l485" class="linenr"> 485</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;USB_TYPE_STANDARD:</div>
<div class="pre"><a id="l486" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l486" class="linenr"> 486</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_process_standard(dev,&nbsp;ctrl,&nbsp;resp);</div>
<div class="pre"><a id="l487" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l487" class="linenr"> 487</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l488" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l488" class="linenr"> 488</a> </div>
<div class="pre"><a id="l489" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l489" class="linenr"> 489</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;USB_TYPE_CLASS:</div>
<div class="pre"><a id="l490" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l490" class="linenr"> 490</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_process_class(dev,&nbsp;ctrl,&nbsp;resp);</div>
<div class="pre"><a id="l491" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l491" class="linenr"> 491</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l492" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l492" class="linenr"> 492</a> </div>
<div class="pre"><a id="l493" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l493" class="linenr"> 493</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</div>
<div class="pre"><a id="l494" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l494" class="linenr"> 494</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l495" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l495" class="linenr"> 495</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l496" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l496" class="linenr"> 496</a> }</div>
<div class="pre"><a id="l497" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l497" class="linenr"> 497</a> </div>
<div class="pre"><a id="l498" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l498" class="linenr"> 498</a> static&nbsp;void</div>
<div class="pre"><a id="l499" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l499" class="linenr"> 499</a> uvc_events_process_data(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;struct&nbsp;uvc_request_data&nbsp;*data)</div>
<div class="pre"><a id="l500" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l500" class="linenr"> 500</a> {</div>
<div class="pre"><a id="l501" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l501" class="linenr"> 501</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_streaming_control&nbsp;*target;</div>
<div class="pre"><a id="l502" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l502" class="linenr"> 502</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_streaming_control&nbsp;*ctrl;</div>
<div class="pre"><a id="l503" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l503" class="linenr"> 503</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;struct&nbsp;uvc_format_info&nbsp;*format;</div>
<div class="pre"><a id="l504" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l504" class="linenr"> 504</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;struct&nbsp;uvc_frame_info&nbsp;*frame;</div>
<div class="pre"><a id="l505" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l505" class="linenr"> 505</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;unsigned&nbsp;int&nbsp;*interval;</div>
<div class="pre"><a id="l506" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l506" class="linenr"> 506</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;iformat,&nbsp;iframe;</div>
<div class="pre"><a id="l507" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l507" class="linenr"> 507</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;unsigned&nbsp;int&nbsp;nframes;</div>
<div class="pre"><a id="l508" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l508" class="linenr"> 508</a> </div>
<div class="pre"><a id="l509" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l509" class="linenr"> 509</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(dev-&gt;control)&nbsp;{</div>
<div class="pre"><a id="l510" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l510" class="linenr"> 510</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_VS_PROBE_CONTROL:</div>
<div class="pre"><a id="l511" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l511" class="linenr"> 511</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;setting&nbsp;probe&nbsp;control,&nbsp;length&nbsp;=&nbsp;%d\n&quot;,&nbsp;data-&gt;length);</div>
<div class="pre"><a id="l512" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l512" class="linenr"> 512</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;&amp;dev-&gt;probe;</div>
<div class="pre"><a id="l513" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l513" class="linenr"> 513</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l514" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l514" class="linenr"> 514</a> </div>
<div class="pre"><a id="l515" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l515" class="linenr"> 515</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_VS_COMMIT_CONTROL:</div>
<div class="pre"><a id="l516" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l516" class="linenr"> 516</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;setting&nbsp;commit&nbsp;control,&nbsp;length&nbsp;=&nbsp;%d\n&quot;,&nbsp;data-&gt;length);</div>
<div class="pre"><a id="l517" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l517" class="linenr"> 517</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target&nbsp;=&nbsp;&amp;dev-&gt;commit;</div>
<div class="pre"><a id="l518" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l518" class="linenr"> 518</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l519" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l519" class="linenr"> 519</a> </div>
<div class="pre"><a id="l520" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l520" class="linenr"> 520</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</div>
<div class="pre"><a id="l521" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l521" class="linenr"> 521</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;setting&nbsp;unknown&nbsp;control,&nbsp;length&nbsp;=&nbsp;%d\n&quot;,&nbsp;data-&gt;length);</div>
<div class="pre"><a id="l522" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l522" class="linenr"> 522</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l523" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l523" class="linenr"> 523</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l524" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l524" class="linenr"> 524</a> </div>
<div class="pre"><a id="l525" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l525" class="linenr"> 525</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctrl&nbsp;=&nbsp;(struct&nbsp;uvc_streaming_control&nbsp;*)&amp;data-&gt;data;</div>
<div class="pre"><a id="l526" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l526" class="linenr"> 526</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iformat&nbsp;=&nbsp;clamp((unsigned&nbsp;int)ctrl-&gt;bFormatIndex,&nbsp;1U,</div>
<div class="pre"><a id="l527" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l527" class="linenr"> 527</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(unsigned&nbsp;int)ARRAY_SIZE(uvc_formats));</div>
<div class="pre"><a id="l528" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l528" class="linenr"> 528</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;format&nbsp;=&nbsp;&amp;uvc_formats[iformat-1];</div>
<div class="pre"><a id="l529" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l529" class="linenr"> 529</a> </div>
<div class="pre"><a id="l530" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l530" class="linenr"> 530</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nframes&nbsp;=&nbsp;0;</div>
<div class="pre"><a id="l531" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l531" class="linenr"> 531</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(format-&gt;frames[nframes].width&nbsp;!=&nbsp;0)</div>
<div class="pre"><a id="l532" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l532" class="linenr"> 532</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++nframes;</div>
<div class="pre"><a id="l533" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l533" class="linenr"> 533</a> </div>
<div class="pre"><a id="l534" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l534" class="linenr"> 534</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;iframe&nbsp;=&nbsp;clamp((unsigned&nbsp;int)ctrl-&gt;bFrameIndex,&nbsp;1U,&nbsp;nframes);</div>
<div class="pre"><a id="l535" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l535" class="linenr"> 535</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;frame&nbsp;=&nbsp;&amp;format-&gt;frames[iframe-1];</div>
<div class="pre"><a id="l536" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l536" class="linenr"> 536</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;interval&nbsp;=&nbsp;frame-&gt;intervals;</div>
<div class="pre"><a id="l537" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l537" class="linenr"> 537</a> </div>
<div class="pre"><a id="l538" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l538" class="linenr"> 538</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(interval[0]&nbsp;&lt;&nbsp;ctrl-&gt;dwFrameInterval&nbsp;&amp;&amp;&nbsp;interval[1])</div>
<div class="pre"><a id="l539" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l539" class="linenr"> 539</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++interval;</div>
<div class="pre"><a id="l540" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l540" class="linenr"> 540</a> </div>
<div class="pre"><a id="l541" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l541" class="linenr"> 541</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target-&gt;bFormatIndex&nbsp;=&nbsp;iformat;</div>
<div class="pre"><a id="l542" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l542" class="linenr"> 542</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target-&gt;bFrameIndex&nbsp;=&nbsp;iframe;</div>
<div class="pre"><a id="l543" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l543" class="linenr"> 543</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(format-&gt;fcc)&nbsp;{</div>
<div class="pre"><a id="l544" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l544" class="linenr"> 544</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;V4L2_PIX_FMT_YUYV:</div>
<div class="pre"><a id="l545" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l545" class="linenr"> 545</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target-&gt;dwMaxVideoFrameSize&nbsp;=&nbsp;frame-&gt;width&nbsp;*&nbsp;frame-&gt;height&nbsp;*&nbsp;2;</div>
<div class="pre"><a id="l546" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l546" class="linenr"> 546</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l547" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l547" class="linenr"> 547</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;V4L2_PIX_FMT_MJPEG:</div>
<div class="pre"><a id="l548" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l548" class="linenr"> 548</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev-&gt;imgsize&nbsp;==&nbsp;0)</div>
<div class="pre"><a id="l549" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l549" class="linenr"> 549</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;WARNING:&nbsp;MJPEG&nbsp;requested&nbsp;and&nbsp;no&nbsp;image&nbsp;loaded.\n&quot;);</div>
<div class="pre"><a id="l550" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l550" class="linenr"> 550</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target-&gt;dwMaxVideoFrameSize&nbsp;=&nbsp;dev-&gt;imgsize;</div>
<div class="pre"><a id="l551" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l551" class="linenr"> 551</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l552" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l552" class="linenr"> 552</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l553" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l553" class="linenr"> 553</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target-&gt;dwFrameInterval&nbsp;=&nbsp;*interval;</div>
<div class="pre"><a id="l554" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l554" class="linenr"> 554</a> </div>
<div class="pre"><a id="l555" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l555" class="linenr"> 555</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev-&gt;control&nbsp;==&nbsp;UVC_VS_COMMIT_CONTROL)&nbsp;{</div>
<div class="pre"><a id="l556" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l556" class="linenr"> 556</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;fcc&nbsp;=&nbsp;format-&gt;fcc;</div>
<div class="pre"><a id="l557" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l557" class="linenr"> 557</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;width&nbsp;=&nbsp;frame-&gt;width;</div>
<div class="pre"><a id="l558" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l558" class="linenr"> 558</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;height&nbsp;=&nbsp;frame-&gt;height;</div>
<div class="pre"><a id="l559" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l559" class="linenr"> 559</a> </div>
<div class="pre"><a id="l560" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l560" class="linenr"> 560</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_set_format(dev);</div>
<div class="pre"><a id="l561" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l561" class="linenr"> 561</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev-&gt;bulk)</div>
<div class="pre"><a id="l562" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l562" class="linenr"> 562</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_stream(dev,&nbsp;1);</div>
<div class="pre"><a id="l563" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l563" class="linenr"> 563</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l564" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l564" class="linenr"> 564</a> }</div>
<div class="pre"><a id="l565" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l565" class="linenr"> 565</a> </div>
<div class="pre"><a id="l566" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l566" class="linenr"> 566</a> static&nbsp;void</div>
<div class="pre"><a id="l567" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l567" class="linenr"> 567</a> uvc_events_process(struct&nbsp;uvc_device&nbsp;*dev)</div>
<div class="pre"><a id="l568" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l568" class="linenr"> 568</a> {</div>
<div class="pre"><a id="l569" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l569" class="linenr"> 569</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_event&nbsp;v4l2_event;</div>
<div class="pre"><a id="l570" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l570" class="linenr"> 570</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_event&nbsp;*uvc_event&nbsp;=&nbsp;(void&nbsp;*)&amp;v4l2_event.u.data;</div>
<div class="pre"><a id="l571" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l571" class="linenr"> 571</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_request_data&nbsp;resp;</div>
<div class="pre"><a id="l572" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l572" class="linenr"> 572</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;ret;</div>
<div class="pre"><a id="l573" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l573" class="linenr"> 573</a> </div>
<div class="pre"><a id="l574" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l574" class="linenr"> 574</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_DQEVENT,&nbsp;&amp;v4l2_event);</div>
<div class="pre"><a id="l575" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l575" class="linenr"> 575</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ret&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l576" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l576" class="linenr"> 576</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;VIDIOC_DQEVENT&nbsp;failed:&nbsp;%s&nbsp;(%d)\n&quot;,&nbsp;strerror(errno),</div>
<div class="pre"><a id="l577" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l577" class="linenr"> 577</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errno);</div>
<div class="pre"><a id="l578" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l578" class="linenr"> 578</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l579" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l579" class="linenr"> 579</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l580" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l580" class="linenr"> 580</a> </div>
<div class="pre"><a id="l581" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l581" class="linenr"> 581</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;resp,&nbsp;0,&nbsp;sizeof&nbsp;resp);</div>
<div class="pre"><a id="l582" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l582" class="linenr"> 582</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;resp.length&nbsp;=&nbsp;-EL2HLT;</div>
<div class="pre"><a id="l583" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l583" class="linenr"> 583</a> </div>
<div class="pre"><a id="l584" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l584" class="linenr"> 584</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(v4l2_event.type)&nbsp;{</div>
<div class="pre"><a id="l585" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l585" class="linenr"> 585</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_EVENT_CONNECT:</div>
<div class="pre"><a id="l586" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l586" class="linenr"> 586</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_EVENT_DISCONNECT:</div>
<div class="pre"><a id="l587" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l587" class="linenr"> 587</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l588" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l588" class="linenr"> 588</a> </div>
<div class="pre"><a id="l589" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l589" class="linenr"> 589</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_EVENT_SETUP:</div>
<div class="pre"><a id="l590" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l590" class="linenr"> 590</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_process_setup(dev,&nbsp;&amp;uvc_event-&gt;req,&nbsp;&amp;resp);</div>
<div class="pre"><a id="l591" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l591" class="linenr"> 591</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l592" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l592" class="linenr"> 592</a> </div>
<div class="pre"><a id="l593" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l593" class="linenr"> 593</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_EVENT_DATA:</div>
<div class="pre"><a id="l594" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l594" class="linenr"> 594</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_process_data(dev,&nbsp;&amp;uvc_event-&gt;data);</div>
<div class="pre"><a id="l595" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l595" class="linenr"> 595</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l596" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l596" class="linenr"> 596</a> </div>
<div class="pre"><a id="l597" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l597" class="linenr"> 597</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_EVENT_STREAMON:</div>
<div class="pre"><a id="l598" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l598" class="linenr"> 598</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_reqbufs(dev,&nbsp;4);</div>
<div class="pre"><a id="l599" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l599" class="linenr"> 599</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_stream(dev,&nbsp;1);</div>
<div class="pre"><a id="l600" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l600" class="linenr"> 600</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l601" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l601" class="linenr"> 601</a> </div>
<div class="pre"><a id="l602" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l602" class="linenr"> 602</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;UVC_EVENT_STREAMOFF:</div>
<div class="pre"><a id="l603" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l603" class="linenr"> 603</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_stream(dev,&nbsp;0);</div>
<div class="pre"><a id="l604" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l604" class="linenr"> 604</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_reqbufs(dev,&nbsp;0);</div>
<div class="pre"><a id="l605" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l605" class="linenr"> 605</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l606" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l606" class="linenr"> 606</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l607" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l607" class="linenr"> 607</a> </div>
<div class="pre"><a id="l608" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l608" class="linenr"> 608</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ioctl(dev-&gt;fd,&nbsp;UVCIOC_SEND_RESPONSE,&nbsp;&amp;resp);</div>
<div class="pre"><a id="l609" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l609" class="linenr"> 609</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ret&nbsp;&lt;&nbsp;0)&nbsp;{</div>
<div class="pre"><a id="l610" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l610" class="linenr"> 610</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;UVCIOC_S_EVENT&nbsp;failed:&nbsp;%s&nbsp;(%d)\n&quot;,&nbsp;strerror(errno),</div>
<div class="pre"><a id="l611" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l611" class="linenr"> 611</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errno);</div>
<div class="pre"><a id="l612" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l612" class="linenr"> 612</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l613" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l613" class="linenr"> 613</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l614" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l614" class="linenr"> 614</a> }</div>
<div class="pre"><a id="l615" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l615" class="linenr"> 615</a> </div>
<div class="pre"><a id="l616" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l616" class="linenr"> 616</a> static&nbsp;void</div>
<div class="pre"><a id="l617" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l617" class="linenr"> 617</a> uvc_events_init(struct&nbsp;uvc_device&nbsp;*dev)</div>
<div class="pre"><a id="l618" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l618" class="linenr"> 618</a> {</div>
<div class="pre"><a id="l619" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l619" class="linenr"> 619</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;v4l2_event_subscription&nbsp;sub;</div>
<div class="pre"><a id="l620" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l620" class="linenr"> 620</a> </div>
<div class="pre"><a id="l621" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l621" class="linenr"> 621</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_fill_streaming_control(dev,&nbsp;&amp;dev-&gt;probe,&nbsp;0,&nbsp;0);</div>
<div class="pre"><a id="l622" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l622" class="linenr"> 622</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_fill_streaming_control(dev,&nbsp;&amp;dev-&gt;commit,&nbsp;0,&nbsp;0);</div>
<div class="pre"><a id="l623" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l623" class="linenr"> 623</a> </div>
<div class="pre"><a id="l624" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l624" class="linenr"> 624</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev-&gt;bulk)&nbsp;{</div>
<div class="pre"><a id="l625" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l625" class="linenr"> 625</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;FIXME&nbsp;Crude&nbsp;hack,&nbsp;must&nbsp;be&nbsp;negotiated&nbsp;with&nbsp;the&nbsp;driver.&nbsp;*/</div>
<div class="pre"><a id="l626" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l626" class="linenr"> 626</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;probe.dwMaxPayloadTransferSize&nbsp;=&nbsp;16&nbsp;*&nbsp;1024;</div>
<div class="pre"><a id="l627" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l627" class="linenr"> 627</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;commit.dwMaxPayloadTransferSize&nbsp;=&nbsp;16&nbsp;*&nbsp;1024;</div>
<div class="pre"><a id="l628" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l628" class="linenr"> 628</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l629" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l629" class="linenr"> 629</a> </div>
<div class="pre"><a id="l630" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l630" class="linenr"> 630</a> </div>
<div class="pre"><a id="l631" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l631" class="linenr"> 631</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memset(&amp;sub,&nbsp;0,&nbsp;sizeof&nbsp;sub);</div>
<div class="pre"><a id="l632" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l632" class="linenr"> 632</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub.type&nbsp;=&nbsp;UVC_EVENT_SETUP;</div>
<div class="pre"><a id="l633" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l633" class="linenr"> 633</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_SUBSCRIBE_EVENT,&nbsp;&amp;sub);</div>
<div class="pre"><a id="l634" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l634" class="linenr"> 634</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub.type&nbsp;=&nbsp;UVC_EVENT_DATA;</div>
<div class="pre"><a id="l635" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l635" class="linenr"> 635</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_SUBSCRIBE_EVENT,&nbsp;&amp;sub);</div>
<div class="pre"><a id="l636" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l636" class="linenr"> 636</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub.type&nbsp;=&nbsp;UVC_EVENT_STREAMON;</div>
<div class="pre"><a id="l637" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l637" class="linenr"> 637</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_SUBSCRIBE_EVENT,&nbsp;&amp;sub);</div>
<div class="pre"><a id="l638" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l638" class="linenr"> 638</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub.type&nbsp;=&nbsp;UVC_EVENT_STREAMOFF;</div>
<div class="pre"><a id="l639" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l639" class="linenr"> 639</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ioctl(dev-&gt;fd,&nbsp;VIDIOC_SUBSCRIBE_EVENT,&nbsp;&amp;sub);</div>
<div class="pre"><a id="l640" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l640" class="linenr"> 640</a> }</div>
<div class="pre"><a id="l641" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l641" class="linenr"> 641</a> </div>
<div class="pre"><a id="l642" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l642" class="linenr"> 642</a> /*&nbsp;---------------------------------------------------------------------------</div>
<div class="pre"><a id="l643" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l643" class="linenr"> 643</a> &nbsp;*&nbsp;main</div>
<div class="pre"><a id="l644" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l644" class="linenr"> 644</a> &nbsp;*/</div>
<div class="pre"><a id="l645" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l645" class="linenr"> 645</a> </div>
<div class="pre"><a id="l646" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l646" class="linenr"> 646</a> static&nbsp;void&nbsp;image_load(struct&nbsp;uvc_device&nbsp;*dev,&nbsp;const&nbsp;char&nbsp;*img)</div>
<div class="pre"><a id="l647" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l647" class="linenr"> 647</a> {</div>
<div class="pre"><a id="l648" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l648" class="linenr"> 648</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;fd&nbsp;=&nbsp;-1;</div>
<div class="pre"><a id="l649" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l649" class="linenr"> 649</a> </div>
<div class="pre"><a id="l650" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l650" class="linenr"> 650</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(img&nbsp;==&nbsp;NULL)</div>
<div class="pre"><a id="l651" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l651" class="linenr"> 651</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l652" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l652" class="linenr"> 652</a> </div>
<div class="pre"><a id="l653" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l653" class="linenr"> 653</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fd&nbsp;=&nbsp;open(img,&nbsp;O_RDONLY);</div>
<div class="pre"><a id="l654" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l654" class="linenr"> 654</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fd&nbsp;==&nbsp;-1)&nbsp;{</div>
<div class="pre"><a id="l655" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l655" class="linenr"> 655</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;open&nbsp;MJPEG&nbsp;image&nbsp;'%s'\n&quot;,&nbsp;img);</div>
<div class="pre"><a id="l656" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l656" class="linenr"> 656</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l657" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l657" class="linenr"> 657</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l658" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l658" class="linenr"> 658</a> </div>
<div class="pre"><a id="l659" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l659" class="linenr"> 659</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;imgsize&nbsp;=&nbsp;lseek(fd,&nbsp;0,&nbsp;SEEK_END);</div>
<div class="pre"><a id="l660" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l660" class="linenr"> 660</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lseek(fd,&nbsp;0,&nbsp;SEEK_SET);</div>
<div class="pre"><a id="l661" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l661" class="linenr"> 661</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;imgdata&nbsp;=&nbsp;malloc(dev-&gt;imgsize);</div>
<div class="pre"><a id="l662" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l662" class="linenr"> 662</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev-&gt;imgdata&nbsp;==&nbsp;NULL)&nbsp;{</div>
<div class="pre"><a id="l663" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l663" class="linenr"> 663</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(&quot;Unable&nbsp;to&nbsp;allocate&nbsp;memory&nbsp;for&nbsp;MJPEG&nbsp;image\n&quot;);</div>
<div class="pre"><a id="l664" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l664" class="linenr"> 664</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;imgsize&nbsp;=&nbsp;0;</div>
<div class="pre"><a id="l665" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l665" class="linenr"> 665</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;</div>
<div class="pre"><a id="l666" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l666" class="linenr"> 666</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l667" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l667" class="linenr"> 667</a> </div>
<div class="pre"><a id="l668" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l668" class="linenr"> 668</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read(fd,&nbsp;dev-&gt;imgdata,&nbsp;dev-&gt;imgsize);</div>
<div class="pre"><a id="l669" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l669" class="linenr"> 669</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;close(fd);</div>
<div class="pre"><a id="l670" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l670" class="linenr"> 670</a> }</div>
<div class="pre"><a id="l671" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l671" class="linenr"> 671</a> </div>
<div class="pre"><a id="l672" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l672" class="linenr"> 672</a> static&nbsp;void&nbsp;usage(const&nbsp;char&nbsp;*argv0)</div>
<div class="pre"><a id="l673" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l673" class="linenr"> 673</a> {</div>
<div class="pre"><a id="l674" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l674" class="linenr"> 674</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;Usage:&nbsp;%s&nbsp;[options]\n&quot;,&nbsp;argv0);</div>
<div class="pre"><a id="l675" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l675" class="linenr"> 675</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;Available&nbsp;options&nbsp;are\n&quot;);</div>
<div class="pre"><a id="l676" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l676" class="linenr"> 676</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;&nbsp;-b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Use&nbsp;bulk&nbsp;mode\n&quot;);</div>
<div class="pre"><a id="l677" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l677" class="linenr"> 677</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;&nbsp;-d&nbsp;device&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Video&nbsp;device\n&quot;);</div>
<div class="pre"><a id="l678" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l678" class="linenr"> 678</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;&nbsp;-h&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Print&nbsp;this&nbsp;help&nbsp;screen&nbsp;and&nbsp;exit\n&quot;);</div>
<div class="pre"><a id="l679" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l679" class="linenr"> 679</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;&nbsp;-i&nbsp;image&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MJPEG&nbsp;image\n&quot;);</div>
<div class="pre"><a id="l680" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l680" class="linenr"> 680</a> }</div>
<div class="pre"><a id="l681" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l681" class="linenr"> 681</a> </div>
<div class="pre"><a id="l682" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l682" class="linenr"> 682</a> int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])</div>
<div class="pre"><a id="l683" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l683" class="linenr"> 683</a> {</div>
<div class="pre"><a id="l684" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l684" class="linenr"> 684</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*device&nbsp;=&nbsp;&quot;/dev/video0&quot;;</div>
<div class="pre"><a id="l685" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l685" class="linenr"> 685</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;uvc_device&nbsp;*dev;</div>
<div class="pre"><a id="l686" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l686" class="linenr"> 686</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;bulk_mode&nbsp;=&nbsp;0;</div>
<div class="pre"><a id="l687" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l687" class="linenr"> 687</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*mjpeg_image&nbsp;=&nbsp;NULL;</div>
<div class="pre"><a id="l688" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l688" class="linenr"> 688</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fd_set&nbsp;fds;</div>
<div class="pre"><a id="l689" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l689" class="linenr"> 689</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;ret,&nbsp;opt;</div>
<div class="pre"><a id="l690" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l690" class="linenr"> 690</a> </div>
<div class="pre"><a id="l691" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l691" class="linenr"> 691</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;((opt&nbsp;=&nbsp;getopt(argc,&nbsp;argv,&nbsp;&quot;bd:hi:&quot;))&nbsp;!=&nbsp;-1)&nbsp;{</div>
<div class="pre"><a id="l692" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l692" class="linenr"> 692</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(opt)&nbsp;{</div>
<div class="pre"><a id="l693" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l693" class="linenr"> 693</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'b':</div>
<div class="pre"><a id="l694" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l694" class="linenr"> 694</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bulk_mode&nbsp;=&nbsp;1;</div>
<div class="pre"><a id="l695" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l695" class="linenr"> 695</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l696" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l696" class="linenr"> 696</a> </div>
<div class="pre"><a id="l697" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l697" class="linenr"> 697</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'d':</div>
<div class="pre"><a id="l698" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l698" class="linenr"> 698</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;device&nbsp;=&nbsp;optarg;</div>
<div class="pre"><a id="l699" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l699" class="linenr"> 699</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l700" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l700" class="linenr"> 700</a> </div>
<div class="pre"><a id="l701" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l701" class="linenr"> 701</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'h':</div>
<div class="pre"><a id="l702" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l702" class="linenr"> 702</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage(argv[0]);</div>
<div class="pre"><a id="l703" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l703" class="linenr"> 703</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</div>
<div class="pre"><a id="l704" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l704" class="linenr"> 704</a> </div>
<div class="pre"><a id="l705" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l705" class="linenr"> 705</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;'i':</div>
<div class="pre"><a id="l706" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l706" class="linenr"> 706</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mjpeg_image&nbsp;=&nbsp;optarg;</div>
<div class="pre"><a id="l707" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l707" class="linenr"> 707</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;</div>
<div class="pre"><a id="l708" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l708" class="linenr"> 708</a> </div>
<div class="pre"><a id="l709" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l709" class="linenr"> 709</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:</div>
<div class="pre"><a id="l710" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l710" class="linenr"> 710</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fprintf(stderr,&nbsp;&quot;Invalid&nbsp;option&nbsp;'-%c'\n&quot;,&nbsp;opt);</div>
<div class="pre"><a id="l711" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l711" class="linenr"> 711</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;usage(argv[0]);</div>
<div class="pre"><a id="l712" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l712" class="linenr"> 712</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</div>
<div class="pre"><a id="l713" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l713" class="linenr"> 713</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l714" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l714" class="linenr"> 714</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l715" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l715" class="linenr"> 715</a> </div>
<div class="pre"><a id="l716" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l716" class="linenr"> 716</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev&nbsp;=&nbsp;uvc_open(device);</div>
<div class="pre"><a id="l717" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l717" class="linenr"> 717</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(dev&nbsp;==&nbsp;NULL)</div>
<div class="pre"><a id="l718" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l718" class="linenr"> 718</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;1;</div>
<div class="pre"><a id="l719" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l719" class="linenr"> 719</a> </div>
<div class="pre"><a id="l720" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l720" class="linenr"> 720</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;image_load(dev,&nbsp;mjpeg_image);</div>
<div class="pre"><a id="l721" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l721" class="linenr"> 721</a> </div>
<div class="pre"><a id="l722" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l722" class="linenr"> 722</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dev-&gt;bulk&nbsp;=&nbsp;bulk_mode;</div>
<div class="pre"><a id="l723" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l723" class="linenr"> 723</a> </div>
<div class="pre"><a id="l724" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l724" class="linenr"> 724</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_init(dev);</div>
<div class="pre"><a id="l725" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l725" class="linenr"> 725</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_init(dev);</div>
<div class="pre"><a id="l726" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l726" class="linenr"> 726</a> </div>
<div class="pre"><a id="l727" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l727" class="linenr"> 727</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FD_ZERO(&amp;fds);</div>
<div class="pre"><a id="l728" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l728" class="linenr"> 728</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FD_SET(dev-&gt;fd,&nbsp;&amp;fds);</div>
<div class="pre"><a id="l729" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l729" class="linenr"> 729</a> </div>
<div class="pre"><a id="l730" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l730" class="linenr"> 730</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(1)&nbsp;{</div>
<div class="pre"><a id="l731" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l731" class="linenr"> 731</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fd_set&nbsp;efds&nbsp;=&nbsp;fds;</div>
<div class="pre"><a id="l732" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l732" class="linenr"> 732</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fd_set&nbsp;wfds&nbsp;=&nbsp;fds;</div>
<div class="pre"><a id="l733" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l733" class="linenr"> 733</a> </div>
<div class="pre"><a id="l734" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l734" class="linenr"> 734</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;=&nbsp;select(dev-&gt;fd&nbsp;+&nbsp;1,&nbsp;NULL,&nbsp;&amp;wfds,&nbsp;&amp;efds,&nbsp;NULL);</div>
<div class="pre"><a id="l735" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l735" class="linenr"> 735</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(FD_ISSET(dev-&gt;fd,&nbsp;&amp;efds))</div>
<div class="pre"><a id="l736" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l736" class="linenr"> 736</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_events_process(dev);</div>
<div class="pre"><a id="l737" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l737" class="linenr"> 737</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(FD_ISSET(dev-&gt;fd,&nbsp;&amp;wfds))</div>
<div class="pre"><a id="l738" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l738" class="linenr"> 738</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_video_process(dev);</div>
<div class="pre"><a id="l739" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l739" class="linenr"> 739</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div>
<div class="pre"><a id="l740" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l740" class="linenr"> 740</a> </div>
<div class="pre"><a id="l741" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l741" class="linenr"> 741</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uvc_close(dev);</div>
<div class="pre"><a id="l742" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l742" class="linenr"> 742</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;</div>
<div class="pre"><a id="l743" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l743" class="linenr"> 743</a> }</div>
<div class="pre"><a id="l744" href="/uvc-gadget.git/blob/3c5a666f9d2eea0e0f7e9a8a0eb8bbfd7687ca13:/uvc-gadget.c#l744" class="linenr"> 744</a> </div>
</div><div class="page_footer">
<div class="page_footer_text">UVC gadget userspace sample application</div>
<a class="rss_logo" href="/uvc-gadget.git/rss?f=uvc-gadget.c" title="history of uvc-gadget.c RSS feed">RSS</a>
<a class="rss_logo" href="/uvc-gadget.git/atom?f=uvc-gadget.c" title="history of uvc-gadget.c Atom feed">Atom</a>
</div>
<script type="text/javascript" src="/static/gitweb.js"></script>
<script type="text/javascript">
window.onload = function () {
	var tz_cookie = { name: 'gitweb_tz', expires: 14, path: '/' };
	onloadTZSetup('local', tz_cookie, 'datetime');
};
</script>
</body>
</html>